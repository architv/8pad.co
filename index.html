<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>URL Shortener project</title>

<style type="text/css">
    textarea{
        width:300px;
        height:300px;
    }
</style>

<body>

<h3>Enter a text in the texbox below and click on the button below</h3>

<textarea id="editor"></textarea>
<button id="submit">Compress </button>


<script type=text/ng-template id=home.html>
    <!-- Home -->
    <ul>
        <li><a href="#/list">Show Items</a></li>
        <li><a href="#/settings">Settings</a></li>
    </ul>
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript" charset="utf-8"></script>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>

<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" charset="utf-8">
    function get_short_url(long_url, login, api_key, func)
    {
    $.getJSON(
        "http://api.bitly.com/v3/shorten?callback=?", 
        { 
            "format": "json",
            "apiKey": api_key,
            "login": login,
            "longUrl": long_url
        },
        function(response)
        {
            func(response.data.hash);
        }
    );
    }
    
    function get_long_url(short_url, login, api_key, func)
    {
    $.getJSON(
        "http://api.bitly.com/v3/expand?callback=?", 
        { 
            "format": "json",
            "apiKey": api_key,
            "login": login,
            "shortUrl": short_url
        },
        function(response)
        {
            func(response.data.expand[0].long_url);
        }
    );
    }
    
    
    var login = "stomatrix";
    var api_key = "R_c3691526084b291593c35ae2883e55cb";
    var long_url = "http://asdasdsad.com/#asdasd";

    /*
    get_short_url(long_url, login, api_key, function(short_url) {
        console.log(short_url);
    });
    */
    
    /*
    list=[];  //make global to allow in-place changes
    function cascade(content,list){
  
        var len=content.length
        splits=[];
        if (len>2000)
        {
            //var n=Math.ceil(len/2000);
            splits=content.match(/.{1,2000}/g);
            sl=splits.length;
            for (i = 0; i < sl; i++) { 
                list=cascade(splits[i],list);
            }
        } 
        else
        {
            list.push(content);
        }
        return list;
    }

    */
    
    $('#submit').click(function(){
      var login = "stomatrix";
      var api_key = "R_c3691526084b291593c35ae2883e55cb";
      content = $('#editor').val();
      console.log(encodeURIComponent(content));
      long_url = "http://a.com/#"+content;
      get_short_url(long_url, login, api_key, function(short_url) {
        console.log(short_url);
      });
      
    });
    
      
    
    $('document').ready(function() {
        //v = "http://on.recode.net/1DRglux";
        //get_long_url(v, login, api_key, function(short_url) {
        //    console.log(short_url);
        //});
    });    
    
</script>

</body>
</html>
